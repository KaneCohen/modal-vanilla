'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_events=require('events'),_events2=_interopRequireDefault(_events);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _factory=document.createElement('div'),_scrollbarWidth=calcScrollbarWidth(),_defaults=Object.freeze({el:null,animate:!0,animateClass:'fade',appendTo:'body',backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),_buttons=deepFreeze({dialog:[{text:'Cancel',value:!1,attr:{class:'btn btn-default',"data-dismiss":'modal'}},{text:'OK',value:!0,attr:{class:'btn btn-primary',"data-dismiss":'modal'}}],alert:[{text:'OK',attr:{class:'btn btn-primary',"data-dismiss":'modal'}}],confirm:[{text:'Cancel',value:!1,attr:{class:'btn btn-default',"data-dismiss":'modal'}},{text:'OK',value:!0,attr:{class:'btn btn-primary',"data-dismiss":'modal'}}]}),_templates={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">\xD7</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function deepFreeze(a){for(var b in a)Array.isArray(a[b])?a[b].forEach(function(a){deepFreeze(a)}):null!==a[b]&&'object'===_typeof(a[b])&&Object.freeze(a[b]);return Object.freeze(a)}function guid(){return(0|65536*(1+Math.random())).toString(16)+(0|65536*(1+Math.random())).toString(16)}function data(a,b,c){var d='data',e=a[d]||{};if('undefined'==typeof c){if(a[d]&&a[d][b])return a[d][b];var f=a.getAttribute(d+'-'+b);return'undefined'==typeof f?null:f}return e[b]=c,a[d]=e,a}function build(a,b){return a.nodeName?a:(a=a.replace(/(\t|\n$)/g,''),_factory.innerHTML='',_factory.innerHTML=a,!0===b?_factory.childNodes:_factory.childNodes[0])}function calcScrollbarWidth(){var a,b,c,d=document.createElement('div');return _extends(d.style,{visibility:'hidden',width:'100px'}),document.body.appendChild(d),c=d.offsetWidth,d.style.overflow='scroll',a=document.createElement('div'),a.style.width='100%',d.appendChild(a),b=c-a.offsetWidth,document.body.removeChild(d),b}function getPath(a){for(var b=[a];a.parentNode;)a=a.parentNode,b.push(a);return nodes}var Modal=function(a){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));if(c.id=guid(),c.el=null,c._html={},c._events={},c._visible=!1,c._options=_extends({},b.options,a),c._templates=_extends({},b.templates,a.templates||{}),c._html.appendTo=document.querySelector(c._options.appendTo),c._baseTemplates={},c._baseButtons={},c._baseOptions={},null===c._options.buttons&&(c._options.buttons=b.buttons.dialog),c._options.el){var d=c._options.el;if('string'==typeof c._options.el&&(d=document.querySelector(c._options.el),!d))throw new Error('Selector: DOM Element '+c._options.el+' not found.');data(d,'modal',c),c.el=d}else c._options.construct=!0;return c._options.construct?c._render():c._mapDom(),c}return _inherits(b,a),_createClass(b,null,[{key:'alert',value:function alert(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=_extends({},_defaults,{title:a,content:!1,construct:!0,headerClose:!1,buttons:b.buttons.alert},c);return new b(d)}},{key:'confirm',value:function confirm(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=_extends({},_defaults,{title:a,content:!1,construct:!0,headerClose:!1,buttons:b.buttons.confirm},c);return new b(d)}},{key:'templates',set:function set(a){this._baseTemplates=a},get:function get(){return _extends({},_templates,b._baseTemplates)}},{key:'buttons',set:function set(a){this._baseButtons=a},get:function get(){return _extends({},_buttons,b._baseButtons)}},{key:'options',set:function set(a){this._baseOptions=a},get:function get(){return _extends({},_defaults,b._baseOptions)}},{key:'version',get:function get(){return'0.3.7'}}]),_createClass(b,[{key:'_render',value:function _render(){var a=this._html,b=this._options,c=this._templates,d=!!b.animate&&b.animateClass;return a.container=build(c.container),a.dialog=build(c.dialog),a.content=build(c.content),a.header=build(c.header),a.headerClose=build(c.headerClose),a.body=build(c.body),a.footer=build(c.footer),d&&a.container.classList.add(d),this._setHeader(),this._setContent(),this._setFooter(),this.el=a.container,a.dialog.appendChild(a.content),a.container.appendChild(a.dialog),this}},{key:'_mapDom',value:function _mapDom(){var a=this._html,b=this._options;return this.el.classList.contains(b.animateClass)&&(b.animate=!0),a.container=this.el,a.dialog=this.el.querySelector('.modal-dialog'),a.content=this.el.querySelector('.modal-content'),a.header=this.el.querySelector('.modal-header'),a.headerClose=this.el.querySelector('.modal-header .close'),a.body=this.el.querySelector('.modal-body'),a.footer=this.el.querySelector('.modal-footer'),this._setHeader(),this._setContent(),this._setFooter(),this}},{key:'_setHeader',value:function _setHeader(){var a=this._html,b=this._options;b.header&&a.header&&(b.title.nodeName?a.header.innerHTML=b.title.outerHTML:'string'==typeof b.title&&(a.header.innerHTML='<h4 class="modal-title">'+b.title+'</h4>'),null===this.el&&a.headerClose&&b.headerClose&&a.header.insertBefore(a.headerClose,a.header.firstChild),b.construct&&a.content.appendChild(a.header))}},{key:'_setContent',value:function _setContent(){var a=this._html,b=this._options;b.content&&a.body&&(a.body.innerHTML='string'==typeof b.content?b.content:b.content.outerHTML,b.construct&&a.content.appendChild(a.body))}},{key:'_setFooter',value:function _setFooter(){var a=this._html,b=this._options;b.footer&&a.footer&&(b.footer.nodeName?a.footer.ineerHTML=b.footer.outerHTML:'string'==typeof b.footer?a.footer.innerHTML=b.footer:!a.footer.children.length&&b.buttons.forEach(function(b){var c=document.createElement('button');data(c,'button',b),c.innerHTML=b.text;var d=!0,e=!1,f=void 0;try{for(var g,h,i=Object.keys(b.attr)[Symbol.iterator]();!(d=(g=i.next()).done);d=!0)h=g.value,c.setAttribute(h,b.attr[h])}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}a.footer.appendChild(c)}),b.construct&&a.content.appendChild(a.footer))}},{key:'_setEvents',value:function _setEvents(){var a=this._options,b=this._html;!0===a.backdrop&&(this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener('keydown',this._events.keydownHandler)),this._events.clickHandler=this._handleClickEvent.bind(this),b.container.addEventListener('click',this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener('resize',this._events.resizeHandler)}},{key:'_handleClickEvent',value:function _handleClickEvent(a){var b=this,c=getPath(a.target);c.every(function(c){return'HTML'!==c.tagName&&!c.classList.contains('modal-content')&&('modal'===c.getAttribute('data-dismiss')?(b.emit('dismiss',b,a,data(a.target,'button')),b.hide(),!1):!c.classList.contains('modal')||(b.emit('dismiss',b,a,null),b.hide(),!1))})}},{key:'_handleKeydownEvent',value:function _handleKeydownEvent(a){27===a.which&&(this.emit('dismiss',this,a,null),this.hide())}},{key:'_handleResizeEvent',value:function _handleResizeEvent(){this._resize()}},{key:'show',value:function show(){var a=this,b=this._options,c=this._html;return this.emit('show',this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add('modal-open'),b.construct&&c.appendTo.appendChild(c.container),c.container.style.display='block',c.container.scrollTop=0,this.once('showBackdrop',function(){a._setEvents(),b.animate&&c.container.offsetWidth,c.container.classList.add('in'),setTimeout(function(){a._visible=!0,a.emit('shown',a)},b.transition)}),this._backdrop(),this._resize(),this}},{key:'toggle',value:function toggle(){this._visible?this.hide():this.show()}},{key:'_resize',value:function _resize(){var a=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&a?_scrollbarWidth+'px':'',this._html.container.style.paddingRight=this.bodyIsOverflowing&&!a?_scrollbarWidth+'px':''}},{key:'_backdrop',value:function _backdrop(){var a=this,b=this._html,c=this._templates,d=this._options,e=!!d.animate&&d.animateClass;b.backdrop=build(c.backdrop),e&&b.backdrop.classList.add(e),b.appendTo.appendChild(b.backdrop),e&&b.backdrop.offsetWidth,b.backdrop.classList.add('in'),setTimeout(function(){a.emit('showBackdrop',a)},this._options.backdropTransition)}},{key:'hide',value:function hide(){var a=this,b=this._html,c=this._options,d=b.backdrop.classList,e=b.container.classList;return this.emit('hide',this),d.remove('in'),e.remove('in'),this._removeEvents(),setTimeout(function(){document.body.classList.remove('modal-open'),document.body.style.paddingRight=a.originalBodyPad},c.backdropTransition),setTimeout(function(){b.backdrop.parentNode.removeChild(b.backdrop),b.container.style.display='none',c.construct&&b.container.remove(),a._visible=!1,a.emit('hidden',a)},c.transition),this}},{key:'_removeEvents',value:function _removeEvents(){this._events.keydownHandler&&document.body.removeEventListener('keydown',this._events.keydownHandler),this._html.container.removeEventListener('click',this._events.clickHandler),window.removeEventListener('resize',this._events.resizeHandler)}},{key:'_checkScrollbar',value:function _checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}},{key:'_setScrollbar',value:function _setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||'',this.bodyIsOverflowing){var a=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=a+_scrollbarWidth+'px'}}}]),b}(_events2.default);exports.default=Modal;
